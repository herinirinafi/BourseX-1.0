<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Login Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
      }
      button {
        background: #007aff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin-right: 10px;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 6px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .token-info {
        background: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
        font-family: monospace;
        font-size: 12px;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîê Admin Login Test</h1>
      <p>
        Test admin authentication and get tokens for the BourseX admin panel.
      </p>

      <div class="form-group">
        <label for="username">Username:</label>
        <select id="username">
          <option value="Admin">Admin</option>
          <option value="manitriniaina">manitriniaina</option>
        </select>
      </div>

      <div class="form-group">
        <label for="password">Password:</label>
        <input
          type="password"
          id="password"
          value="admin123"
          placeholder="Enter password"
        />
      </div>

      <button onclick="testLogin()">üöÄ Test Login</button>
      <button onclick="applyTokens()">üì± Apply Tokens to Frontend</button>
      <button onclick="clearTokens()">üóëÔ∏è Clear Tokens</button>

      <div id="result"></div>
    </div>

    <script>
      const API_BASE = "http://127.0.0.1:8000";
      let currentTokens = null;

      async function testLogin() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const resultDiv = document.getElementById("result");

        resultDiv.innerHTML = '<div class="result">üîÑ Testing login...</div>';

        try {
          const response = await fetch(`${API_BASE}/api/auth/login/`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          });

          if (response.ok) {
            const data = await response.json();
            currentTokens = data;

            // Test getting user profile
            const userResponse = await fetch(`${API_BASE}/api/current-user/`, {
              headers: {
                Authorization: `Bearer ${data.access}`,
              },
            });
            if (userResponse.ok) {
              const userData = await userResponse.json();

              resultDiv.innerHTML = `
                            <div class="result success">
                                <h3>‚úÖ Login Successful!</h3>
                                <p><strong>Username:</strong> ${
                                  userData.username
                                }</p>
                                <p><strong>Email:</strong> ${userData.email}</p>
                                <p><strong>Staff Status:</strong> ${
                                  userData.is_staff
                                    ? "‚úÖ Admin"
                                    : "‚ùå Regular User"
                                }</p>
                                <p><strong>Active:</strong> ${
                                  userData.is_active ? "Yes" : "No"
                                }</p>
                            </div>
                            <div class="result token-info">
                                <h4>üìã Tokens (click Apply Tokens button to use):</h4>
                                <p><strong>Access Token:</strong><br>${
                                  data.access
                                }</p>
                                <p><strong>Refresh Token:</strong><br>${
                                  data.refresh
                                }</p>
                            </div>
                        `;
            } else {
              throw new Error("Failed to get user profile");
            }
          } else {
            const errorData = await response.text();
            resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå Login Failed</h3>
                            <p>Status: ${response.status}</p>
                            <p>Error: ${errorData}</p>
                        </div>
                    `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
        }
      }

      function applyTokens() {
        if (!currentTokens) {
          alert("No tokens available. Please login first.");
          return;
        }

        // Set tokens in localStorage
        localStorage.setItem("authToken", currentTokens.access);
        localStorage.setItem("refreshToken", currentTokens.refresh);

        alert(
          "‚úÖ Tokens applied to localStorage! The frontend will now recognize you as logged in. Refresh the page if needed."
        );

        document.getElementById("result").innerHTML += `
                <div class="result success">
                    <h4>‚úÖ Tokens Applied!</h4>
                    <p>The tokens have been saved to localStorage. Your frontend app should now recognize you as logged in.</p>
                    <p><strong>Next steps:</strong></p>
                    <ol>
                        <li>Go to your React Native Web app</li>
                        <li>Navigate to <code>/admin</code></li>
                        <li>You should now have admin access</li>
                    </ol>
                </div>
            `;
      }

      function clearTokens() {
        localStorage.removeItem("authToken");
        localStorage.removeItem("refreshToken");
        currentTokens = null;

        document.getElementById("result").innerHTML = `
                <div class="result">
                    <h4>üóëÔ∏è Tokens Cleared</h4>
                    <p>All authentication tokens have been removed from localStorage.</p>
                </div>
            `;
      }

      // Check current tokens on load
      window.onload = function () {
        const existingToken = localStorage.getItem("authToken");
        if (existingToken) {
          document.getElementById("result").innerHTML = `
                    <div class="result token-info">
                        <h4>üì± Current Token Found</h4>
                        <p>There's already an auth token in localStorage:</p>
                        <p>${existingToken.substring(0, 50)}...</p>
                        <p>You can clear it and login again, or try using the current token.</p>
                    </div>
                `;
        }
      };
    </script>
  </body>
</html>
